# Copyright 2025 SAP SE
# SPDX-License-Identifier: Apache-2.0

owner-info:
  enabled: true
  helm-chart-url: "https://github.com/cobaltcore-dev/cortex/helm/bundles/cortex-nova"
  maintainers:
    - "arno.uhlig@sap.com"
    - "julius.clausnitzer@sap.com"
    - "malte.viering@sap.com"
    - "marcel.bloecher@sap.com"
    - "markus.wieland@sap.com"
    - "p.matthes@sap.com"
  support-group: "workload-management"
  service: "cortex-nova"

alerts:
  enabled: true
  prometheus: openstack

# SSO certificate to use.
sharedSSOCert: &sharedSSOCert
  # Certificate "public key". (Optional, remove this key if not needed)
  cert: |
    -----BEGIN CERTIFICATE-----
    Your certificate here
    -----END CERTIFICATE-----
  # Certificate private key. (Optional, remove this key if not needed)
  key: |
    -----BEGIN PRIVATE KEY-----
    Your private key here
    -----END PRIVATE KEY-----
  # Whether the certificate is self-signed.
  # If true, the certificate is not verified.
  selfSigned: "false"

postgres:
  host: cortex-nova-postgresql
  user: postgres
  password: secret
  database: postgres
  port: "5432"

prometheus:
  url: "https://path-to-your-prometheus"
  sso:
    enabled: false
    <<: *sharedSSOCert

openstack:
  url: "https://path-to-keystone/v3"
  availability: public
  username: openstack-user-with-all-project-read-access
  password: openstack-user-password
  projectName: openstack-project-of-user
  userDomainName: openstack-domain-of-user
  projectDomainName: openstack-domain-of-project-scoped-to
  sso:
    enabled: false
    <<: *sharedSSOCert

pipelines:
  createDecisions: false

cortex: &cortex
  crd: {enable: false}
  # Disable the default ServiceMonitor and metrics service from the kubebuilder stack.
  # A centralized ServiceMonitor and metrics service are defined in the cortex-nova chart.
  metrics: {enable: false}
  prometheus: {enable: false}
  namePrefix: cortex-nova
  conf: &cortexConf
    operator: cortex-nova
    keystoneSecretRef:
      name: cortex-nova-openstack-keystone
      namespace: default
    # ssoSecretRef:
    #   name: cortex-nova-openstack-sso
    #   namespace: default
    monitoring:
      labels: &cortexMonitoringLabels
        github_org: cobaltcore-dev
        github_repo: cortex

# Split deployments
cortex-scheduling-controllers:
  <<: *cortex
  namePrefix: cortex-nova-scheduling
  conf:
    <<: *cortexConf
    leaderElectionID: cortex-nova-scheduling
    monitoring:
      labels:
        <<: *cortexMonitoringLabels
        component: nova-scheduling
    enabledControllers:
      - nova-decisions-pipeline-controller
      - nova-deschedulings-pipeline-controller
      - explanation-controller

cortex-knowledge-controllers:
  <<: *cortex
  namePrefix: cortex-nova-knowledge
  conf:
    <<: *cortexConf
    leaderElectionID: cortex-nova-knowledge
    monitoring:
      labels:
        <<: *cortexMonitoringLabels
        component: nova-knowledge
    enabledControllers:
      - datasource-controllers
      - knowledge-controllers
      - kpis-controller

cortex-reservations-controllers:
  <<: *cortex
  namePrefix: cortex-nova-reservations
  conf:
    <<: *cortexConf
    leaderElectionID: cortex-nova-reservations
    monitoring:
      labels:
        <<: *cortexMonitoringLabels
        component: nova-reservations
    enabledControllers:
      - reservations-controller
    enabledTasks:
      - commitments-sync-task

# Custom configuration for the cortex postgres chart.
cortex-postgres:
  fullnameOverride: cortex-nova-postgresql