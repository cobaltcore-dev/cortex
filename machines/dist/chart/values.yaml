# This file is safe from kubebuilder edit --plugins=helm/v1-alpha
# If you want to re-generate, add the --force flag.

owner-info:
  enabled: true
  helm-chart-url: "https://github.com/cobaltcore-dev/cortex/machines/dist/chart"
  maintainers:
    - "p.matthes@sap.com"
    - "markus.wieland@sap.com"
    - "arno.uhlig@sap.com"
  support-group: "workload-management"
  service: "cortex-machines"

# [MANAGER]: Manager Deployment Configurations
controllerManager:
  replicas: 1
  container:
    image:
      repository: ghcr.io/cobaltcore-dev/cortex-machines-operator
    args:
      - "--leader-elect"
      - "--metrics-bind-address=:8443"
      - "--health-probe-bind-address=:8081"
    resources:
      limits:
        cpu: 500m
        memory: 512Mi
      requests:
        cpu: 10m
        memory: 64Mi
    livenessProbe:
      initialDelaySeconds: 15
      periodSeconds: 20
      httpGet:
        path: /healthz
        port: 8081
    readinessProbe:
      initialDelaySeconds: 5
      periodSeconds: 10
      httpGet:
        path: /readyz
        port: 8081
    securityContext:
      allowPrivilegeEscalation: false
      capabilities:
        drop:
          - "ALL"
  securityContext:
    runAsNonRoot: true
    seccompProfile:
      type: RuntimeDefault
  terminationGracePeriodSeconds: 10
  serviceAccountName: machines-controller-manager

# [RBAC]: To enable RBAC (Permissions) configurations
rbac:
  enable: true

# [CRDs]: To enable the CRDs
crd:
  # This option determines whether the CRDs are included
  # in the installation process.
  enable: true

  # Enabling this option adds the "helm.sh/resource-policy": keep
  # annotation to the CRD, ensuring it remains installed even when
  # the Helm release is uninstalled.
  # NOTE: Removing the CRDs will also remove all cert-manager CR(s)
  # (Certificates, Issuers, ...) due to garbage collection.
  keep: true

# [METRICS]: Set to true to generate manifests for exporting metrics.
# To disable metrics export set false, and ensure that the
# ControllerManager argument "--metrics-bind-address=:8443" is removed.
metrics:
  enable: true

# [PROMETHEUS]: To enable a ServiceMonitor to export metrics to Prometheus set true
prometheus:
  enable: true

# [CERT-MANAGER]: To enable cert-manager injection to webhooks set true
certmanager:
  enable: false

# [NETWORK POLICIES]: To enable NetworkPolicies set true
networkPolicy:
  enable: false

# Values shared between other cortex charts.
global:
  # Values passed to the service through a configmap.
  conf:
    # MQTT broker connection parameters.
    mqtt:
      url: "tcp://path-to-your-mqtt:1883"
    # Connection parameters for the database where data is stored.
    db:
      host: "your-postgres-host"

# Config for the machines controller.
conf:
  # Configuration of metrics exported to the /metrics endpoint.
  monitoring:
    # The port to expose the metrics on.
    port: 2112

    # Custom labels added to the exported metrics.
    labels:
      github_org: cobaltcore-dev
      github_repo: cortex

  # Connection parameters for the database where data is stored.
  db:
    host:
    port: 5432
    database: postgres
    reconnect:
      maxRetries: 20
      retryIntervalSeconds: 1
      livenessPingIntervalSeconds: 5

  # MQTT broker connection parameters.
  mqtt:
    # Must match rabbitmq settings from the cortex-mqtt chart.
    url:
    # Configure how Cortex should handle lost connections to the MQTT broker.
    reconnect:
      maxRetries: 20
      retryIntervalSeconds: 1

  scheduler:
    machines:
      pipelines:
        # Note: there needs to be at least one pipeline with the name "default".
        - name: default

          # Configuration of scheduler steps for ironcore machines.
          # Each scheduler step can specify its own dependencies on extractors and
          # synced data.
          #
          # The `name` should correspond to a known scheduler plugin.
          # Note that all scheduler steps will be executed in parallel. However,
          # the order will be maintained when the weights are applied.
          plugins:
            - name: noop
              # Options for the scheduler plugin.
              options: {}
              # Dependencies needed by this scheduler plugin.
              dependencies: {} # e.g. {extractors: [my_nova_extractor]}

# Values passed to the service through a kubernetes secret.
# The keys of these values should correspond to the keys used above in the conf.
#
# Note: Please only add values here that MUST be overridden using the "secrets:" key.
secrets:
  # MQTT broker connection credentials.
  mqtt:
    username: cortex
    password: secret
  # Database connection credentials.
  db:
    user: postgres
    password: secret
