{{- if .Values.crd.enable }}
---
apiVersion: apiextensions.k8s.io/v1
kind: CustomResourceDefinition
metadata:
  labels:
    {{- include "chart.labels" . | nindent 4 }}
  annotations:
    {{- if .Values.crd.keep }}
    "helm.sh/resource-policy": keep
    {{- end }}
    controller-gen.kubebuilder.io/version: v0.17.2
  name: decisions.scheduling.cortex
spec:
  group: scheduling.cortex
  names:
    kind: Decision
    listKind: DecisionList
    plural: decisions
    singular: decision
  scope: Cluster
  versions:
  - additionalPrinterColumns:
    - jsonPath: .spec.operator
      name: Operator
      type: string
    - jsonPath: .spec.type
      name: Type
      type: string
    - jsonPath: .spec.resourceID
      name: Resource ID
      type: string
    - jsonPath: .metadata.creationTimestamp
      name: Created
      type: date
    - jsonPath: .status.took
      name: Took
      type: string
    - jsonPath: .spec.pipelineRef.name
      name: Pipeline
      type: string
    - jsonPath: .status.sourceHost
      name: SourceHost
      type: string
    - jsonPath: .status.targetHost
      name: TargetHost
      type: string
    - jsonPath: .status.error
      name: Error
      type: string
    name: v1alpha1
    schema:
      openAPIV3Schema:
        description: Decision is the Schema for the decisions API
        properties:
          apiVersion:
            description: |-
              APIVersion defines the versioned schema of this representation of an object.
              Servers should convert recognized schemas to the latest internal value, and
              may reject unrecognized values.
              More info: https://git.k8s.io/community/contributors/devel/sig-architecture/api-conventions.md#resources
            type: string
          kind:
            description: |-
              Kind is a string value representing the REST resource this object represents.
              Servers may infer this from the endpoint the client submits requests to.
              Cannot be updated.
              In CamelCase.
              More info: https://git.k8s.io/community/contributors/devel/sig-architecture/api-conventions.md#types-kinds
            type: string
          metadata:
            type: object
          spec:
            description: spec defines the desired state of Decision
            properties:
              cinderRaw:
                description: If the type is "cinder", this field contains the raw
                  cinder decision request.
                type: object
                x-kubernetes-preserve-unknown-fields: true
              machineRef:
                description: If the type is "machine", this field contains the machine
                  reference.
                properties:
                  apiVersion:
                    description: API version of the referent.
                    type: string
                  fieldPath:
                    description: |-
                      If referring to a piece of an object instead of an entire object, this string
                      should contain a valid JSON/Go field access statement, such as desiredState.manifest.containers[2].
                      For example, if the object reference is to a container within a pod, this would take on a value like:
                      "spec.containers{name}" (where "name" refers to the name of the container that triggered
                      the event) or if no container name is specified "spec.containers[2]" (container with
                      index 2 in this pod). This syntax is chosen only to have some well-defined way of
                      referencing a part of an object.
                    type: string
                  kind:
                    description: |-
                      Kind of the referent.
                      More info: https://git.k8s.io/community/contributors/devel/sig-architecture/api-conventions.md#types-kinds
                    type: string
                  name:
                    description: |-
                      Name of the referent.
                      More info: https://kubernetes.io/docs/concepts/overview/working-with-objects/names/#names
                    type: string
                  namespace:
                    description: |-
                      Namespace of the referent.
                      More info: https://kubernetes.io/docs/concepts/overview/working-with-objects/namespaces/
                    type: string
                  resourceVersion:
                    description: |-
                      Specific resourceVersion to which this reference is made, if any.
                      More info: https://git.k8s.io/community/contributors/devel/sig-architecture/api-conventions.md#concurrency-control-and-consistency
                    type: string
                  uid:
                    description: |-
                      UID of the referent.
                      More info: https://kubernetes.io/docs/concepts/overview/working-with-objects/names/#uids
                    type: string
                type: object
                x-kubernetes-map-type: atomic
              manilaRaw:
                description: If the type is "manila", this field contains the raw
                  manila decision request.
                type: object
                x-kubernetes-preserve-unknown-fields: true
              novaRaw:
                description: If the type is "nova", this field contains the raw nova
                  decision request.
                type: object
                x-kubernetes-preserve-unknown-fields: true
              operator:
                description: The operator by which this decision should be extracted.
                type: string
              pipelineRef:
                description: |-
                  A reference to the pipeline that should be used for this decision.
                  This reference can be used to look up the pipeline definition and its
                  scheduler step configuration for additional context.
                properties:
                  apiVersion:
                    description: API version of the referent.
                    type: string
                  fieldPath:
                    description: |-
                      If referring to a piece of an object instead of an entire object, this string
                      should contain a valid JSON/Go field access statement, such as desiredState.manifest.containers[2].
                      For example, if the object reference is to a container within a pod, this would take on a value like:
                      "spec.containers{name}" (where "name" refers to the name of the container that triggered
                      the event) or if no container name is specified "spec.containers[2]" (container with
                      index 2 in this pod). This syntax is chosen only to have some well-defined way of
                      referencing a part of an object.
                    type: string
                  kind:
                    description: |-
                      Kind of the referent.
                      More info: https://git.k8s.io/community/contributors/devel/sig-architecture/api-conventions.md#types-kinds
                    type: string
                  name:
                    description: |-
                      Name of the referent.
                      More info: https://kubernetes.io/docs/concepts/overview/working-with-objects/names/#names
                    type: string
                  namespace:
                    description: |-
                      Namespace of the referent.
                      More info: https://kubernetes.io/docs/concepts/overview/working-with-objects/namespaces/
                    type: string
                  resourceVersion:
                    description: |-
                      Specific resourceVersion to which this reference is made, if any.
                      More info: https://git.k8s.io/community/contributors/devel/sig-architecture/api-conventions.md#concurrency-control-and-consistency
                    type: string
                  uid:
                    description: |-
                      UID of the referent.
                      More info: https://kubernetes.io/docs/concepts/overview/working-with-objects/names/#uids
                    type: string
                type: object
                x-kubernetes-map-type: atomic
              resourceID:
                description: |-
                  An identifier for the underlying resource to be scheduled.
                  For example, this can be the UUID of a nova instance or cinder volume.
                  This can be used to correlate multiple decisions for the same resource.
                type: string
              sourceHost:
                description: |-
                  When there is a source host for the decision, it is recorded here.

                  Note: for initial placements, this will be empty. However, for migrations
                  or resizes, this will contain the source host.
                type: string
              type:
                description: The type of decision, indicating what has initiated this
                  decision.
                type: string
            required:
            - pipelineRef
            - resourceID
            - type
            type: object
          status:
            description: status defines the observed state of Decision
            properties:
              cinder:
                description: |-
                  If the decision decision type is "cinder", this field contains the
                  cinder decision decision.
                properties:
                  stepResults:
                    description: |-
                      Outputs of the decision pipeline including the activations used
                      to make the final ordering of storage hosts.
                    items:
                      properties:
                        activations:
                          additionalProperties:
                            type: number
                          description: Activations of the step for each host.
                          type: object
                        stepName:
                          description: Name of the scheduler step.
                          type: string
                      required:
                      - activations
                      - stepName
                      type: object
                    type: array
                  storagePools:
                    description: Sorted list of storage hosts from more preferred
                      to least preferred.
                    items:
                      type: string
                    type: array
                type: object
              error:
                description: If there was an error during the last decision, it is
                  recorded here.
                type: string
              explanation:
                description: A human-readable explanation of the decision result.
                type: string
              history:
                description: |-
                  If there were previous decisions for the underlying resource, they can
                  be resolved here to provide historical context for the decision.
                items:
                  description: ObjectReference contains enough information to let
                    you inspect or modify the referred object.
                  properties:
                    apiVersion:
                      description: API version of the referent.
                      type: string
                    fieldPath:
                      description: |-
                        If referring to a piece of an object instead of an entire object, this string
                        should contain a valid JSON/Go field access statement, such as desiredState.manifest.containers[2].
                        For example, if the object reference is to a container within a pod, this would take on a value like:
                        "spec.containers{name}" (where "name" refers to the name of the container that triggered
                        the event) or if no container name is specified "spec.containers[2]" (container with
                        index 2 in this pod). This syntax is chosen only to have some well-defined way of
                        referencing a part of an object.
                      type: string
                    kind:
                      description: |-
                        Kind of the referent.
                        More info: https://git.k8s.io/community/contributors/devel/sig-architecture/api-conventions.md#types-kinds
                      type: string
                    name:
                      description: |-
                        Name of the referent.
                        More info: https://kubernetes.io/docs/concepts/overview/working-with-objects/names/#names
                      type: string
                    namespace:
                      description: |-
                        Namespace of the referent.
                        More info: https://kubernetes.io/docs/concepts/overview/working-with-objects/namespaces/
                      type: string
                    resourceVersion:
                      description: |-
                        Specific resourceVersion to which this reference is made, if any.
                        More info: https://git.k8s.io/community/contributors/devel/sig-architecture/api-conventions.md#concurrency-control-and-consistency
                      type: string
                    uid:
                      description: |-
                        UID of the referent.
                        More info: https://kubernetes.io/docs/concepts/overview/working-with-objects/names/#uids
                      type: string
                  type: object
                  x-kubernetes-map-type: atomic
                type: array
              machine:
                description: |-
                  If the decision decision type is "machine", this field contains the
                  machine decision decision.
                properties:
                  machinePools:
                    description: Sorted list of machine pools from more preferred
                      to least preferred.
                    items:
                      type: string
                    type: array
                  stepResults:
                    description: |-
                      Outputs of the decision pipeline including the activations used
                      to make the final ordering of machine pools.
                    items:
                      properties:
                        activations:
                          additionalProperties:
                            type: number
                          description: Activations of the step for each host.
                          type: object
                        stepName:
                          description: Name of the scheduler step.
                          type: string
                      required:
                      - activations
                      - stepName
                      type: object
                    type: array
                type: object
              manila:
                description: |-
                  If the decision decision type is "manila", this field contains the
                  manila decision decision.
                properties:
                  stepResults:
                    description: |-
                      Outputs of the decision pipeline including the activations used
                      to make the final ordering of share hosts.
                    items:
                      properties:
                        activations:
                          additionalProperties:
                            type: number
                          description: Activations of the step for each host.
                          type: object
                        stepName:
                          description: Name of the scheduler step.
                          type: string
                      required:
                      - activations
                      - stepName
                      type: object
                    type: array
                  storagePools:
                    description: Sorted list of share hosts from more preferred to
                      least preferred.
                    items:
                      type: string
                    type: array
                type: object
              nova:
                description: |-
                  If the decision decision type is "nova", this field contains the
                  nova decision decision.
                properties:
                  computeHosts:
                    description: Sorted list of compute hosts from more preferred
                      to least preferred.
                    items:
                      type: string
                    type: array
                  stepResults:
                    description: |-
                      Outputs of the decision pipeline including the activations used
                      to make the final ordering of compute hosts.
                    items:
                      properties:
                        activations:
                          additionalProperties:
                            type: number
                          description: Activations of the step for each host.
                          type: object
                        stepName:
                          description: Name of the scheduler step.
                          type: string
                      required:
                      - activations
                      - stepName
                      type: object
                    type: array
                type: object
              targetHost:
                description: |-
                  When there is a designated target host for the decision, it is recorded
                  here.

                  Note: for external scheduler requests, this will be the first host from
                  the list of returned hosts -- meaning there is no guarantee this is
                  actually the host where the resource will be spawned on. Please check
                  the decision details to see the full list of hosts and their scores.

                  For dedecisions, this will be empty, indicating there is no specific
                  target host.
                type: string
              took:
                description: The time it took to schedule.
                type: string
            type: object
        required:
        - spec
        type: object
    served: true
    storage: true
    subresources:
      status: {}
{{- end -}}
